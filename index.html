<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GT7 Telemetry Dashboard</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/uplot.min.css">
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <span class="header-title">GT7 TELEMETRY DASHBOARD</span>
            <div class="header-flags" id="flags-bar"></div>
            <div id="connection-status" class="disconnected">Disconnected</div>
        </div>

        <!-- Left Panel -->
        <div class="left-panel">
            <div class="card speed-card">
                <div class="speed-value" id="speed">0</div>
                <div class="speed-unit">km/h</div>
            </div>

            <div class="card gear-rpm-card">
                <div class="gear-display">
                    <div class="gear-value" id="gear">N</div>
                    <div class="gear-label">GEAR</div>
                    <div class="suggested-gear" id="suggested-gear"></div>
                    <div class="wheel-rotation" id="wheel-rotation">0.0&deg;</div>
                </div>
                <div class="rpm-display">
                    <div class="rpm-bar-bg">
                        <div class="rpm-bar" id="rpm-bar"></div>
                    </div>
                    <div class="rpm-text" id="rpm-text">0 RPM</div>
                </div>
            </div>

            <div class="card pedals-card">
                <div class="pedal-row">
                    <span class="pedal-label">THR</span>
                    <div class="pedal-bar-bg">
                        <div class="throttle-bar" id="throttle-bar"></div>
                        <div class="filtered-bar throttle-filtered-bar" id="throttle-filtered-bar"></div>
                    </div>
                    <span class="pedal-value" id="throttle-value">0%</span>
                </div>
                <div class="pedal-row">
                    <span class="pedal-label">BRK</span>
                    <div class="pedal-bar-bg">
                        <div class="brake-bar" id="brake-bar"></div>
                        <div class="filtered-bar brake-filtered-bar" id="brake-filtered-bar"></div>
                    </div>
                    <span class="pedal-value" id="brake-value">0%</span>
                </div>
                <div class="pedal-row">
                    <span class="pedal-label">CLT</span>
                    <div class="pedal-bar-bg">
                        <div class="clutch-bar" id="clutch-bar"></div>
                    </div>
                    <span class="pedal-value" id="clutch-value">0%</span>
                </div>
            </div>

            <div class="card fuel-card">
                <div class="card-title">FUEL</div>
                <div class="fuel-grid">
                    <div class="fuel-item">
                        <div class="fuel-value" id="fuel">--</div>
                        <div class="fuel-label">LEVEL (L)</div>
                    </div>
                    <div class="fuel-item">
                        <div class="fuel-value" id="fuel-capacity">--</div>
                        <div class="fuel-label">CAPACITY</div>
                    </div>
                    <div class="fuel-item">
                        <div class="fuel-value" id="fuel-per-lap">--</div>
                        <div class="fuel-label">PER LAP</div>
                    </div>
                    <div class="fuel-item">
                        <div class="fuel-value" id="fuel-laps-remaining">--</div>
                        <div class="fuel-label">LAPS LEFT</div>
                    </div>
                </div>
            </div>

            <div class="card fuel-boost-grid">
                <div class="fuel-boost-item">
                    <div class="fuel-boost-value boost" id="boost">--</div>
                    <div class="fuel-boost-label">BOOST (%)</div>
                </div>
                <div class="fuel-boost-item">
                    <div class="fuel-boost-value" id="oil-pressure">--</div>
                    <div class="fuel-boost-label">OIL (bar)</div>
                </div>
            </div>

            <div class="card stat-card">
                <div class="stat-value" id="max-speed">--</div>
                <div class="stat-label">MAX SPEED (km/h)</div>
            </div>

            <div class="card stat-card">
                <div class="stat-value" id="trans-max-speed">--</div>
                <div class="stat-label">TRANS MAX (km/h)</div>
            </div>

            <div class="card gear-ratios-card">
                <div class="card-title">GEAR RATIOS</div>
                <div class="gear-ratios-grid" id="gear-ratios">
                    <span class="gear-ratio-placeholder">Waiting for data...</span>
                </div>
            </div>

            <div class="card clutch-detail-card">
                <div class="card-title">CLUTCH DETAIL</div>
                <div class="position-row">
                    <span class="position-label">ENG</span>
                    <span class="position-value" id="clutch-engagement">--</span>
                    <span class="position-label" style="margin-left:8px">GBR</span>
                    <span class="position-value" id="clutch-gearbox-rpm">--</span>
                </div>
            </div>
        </div>

        <!-- Center Panel -->
        <div class="center-panel">
            <div class="charts-container">
                <div class="chart-wrapper">
                    <div class="chart-title">SPEED</div>
                    <div id="speed-chart" class="chart"></div>
                </div>
                <div class="chart-wrapper">
                    <div class="chart-title">RPM</div>
                    <div id="rpm-chart" class="chart"></div>
                </div>
                <div class="chart-wrapper">
                    <div class="chart-title">THROTTLE</div>
                    <div id="throttle-chart" class="chart"></div>
                </div>
                <div class="chart-wrapper">
                    <div class="chart-title">BRAKE</div>
                    <div id="brake-chart" class="chart"></div>
                </div>
            </div>

            <div class="card car-3d-card">
                <div class="card-title">CAR ATTITUDE</div>
                <div class="car-3d-container">
                    <div id="car-3d-view"></div>
                    <div class="car-3d-info">
                        <div class="car-3d-info-row">
                            <span class="car-3d-label">PITCH</span>
                            <span class="car-3d-value" id="car-3d-pitch">0.00&deg;</span>
                        </div>
                        <div class="car-3d-info-row">
                            <span class="car-3d-label">ROLL</span>
                            <span class="car-3d-value" id="car-3d-roll">0.00&deg;</span>
                        </div>
                        <div class="car-3d-info-row">
                            <span class="car-3d-label">YAW</span>
                            <span class="car-3d-value" id="car-3d-yaw">0.00&deg;</span>
                        </div>
                    </div>
                </div>
                <div class="car-top-view-container">
                    <div class="card-title" style="font-size: 8px; color: var(--text-secondary); text-transform: uppercase; padding: 4px 10px;">TOP VIEW</div>
                    <div id="car-top-view"></div>
                </div>
            </div>

            <div class="card course-map-card">
                <div class="course-map-header">
                    <div class="card-title">COURSE MAP</div>
                    <span class="course-name" id="course-name"></span>
                    <button id="test-mode-btn" class="test-mode-btn">TEST MODE</button>
                </div>
                <div class="course-map-container">
                    <canvas id="course-map"></canvas>
                    <div class="course-map-info" id="course-map-info">Waiting for data...</div>
                </div>
            </div>

            <div class="card tyres-card">
                <div class="card-title">TYRES</div>
                <div class="tyres-grid">
                    <div class="tyre-item">
                        <div class="tyre-pos">FL</div>
                        <div class="tyre-data-row">
                            <div class="tyre-temp-row">
                                <span class="tyre-temp" id="fl-temp">--</span>
                                <span class="tyre-temp-unit">&deg;C</span>
                            </div>
                            <div class="tyre-rps-row">
                                <span class="tyre-rps" id="fl-rps">--</span>
                                <span class="tyre-rps-unit">rps</span>
                            </div>
                            <div class="tyre-radius-row">
                                <span class="tyre-radius" id="fl-radius">--</span>
                                <span class="tyre-radius-unit">m</span>
                            </div>
                        </div>
                    </div>
                    <div class="tyre-item">
                        <div class="tyre-pos">FR</div>
                        <div class="tyre-data-row">
                            <div class="tyre-temp-row">
                                <span class="tyre-temp" id="fr-temp">--</span>
                                <span class="tyre-temp-unit">&deg;C</span>
                            </div>
                            <div class="tyre-rps-row">
                                <span class="tyre-rps" id="fr-rps">--</span>
                                <span class="tyre-rps-unit">rps</span>
                            </div>
                            <div class="tyre-radius-row">
                                <span class="tyre-radius" id="fr-radius">--</span>
                                <span class="tyre-radius-unit">m</span>
                            </div>
                        </div>
                    </div>
                    <div class="tyre-item">
                        <div class="tyre-pos">RL</div>
                        <div class="tyre-data-row">
                            <div class="tyre-temp-row">
                                <span class="tyre-temp" id="rl-temp">--</span>
                                <span class="tyre-temp-unit">&deg;C</span>
                            </div>
                            <div class="tyre-rps-row">
                                <span class="tyre-rps" id="rl-rps">--</span>
                                <span class="tyre-rps-unit">rps</span>
                            </div>
                            <div class="tyre-radius-row">
                                <span class="tyre-radius" id="rl-radius">--</span>
                                <span class="tyre-radius-unit">m</span>
                            </div>
                        </div>
                    </div>
                    <div class="tyre-item">
                        <div class="tyre-pos">RR</div>
                        <div class="tyre-data-row">
                            <div class="tyre-temp-row">
                                <span class="tyre-temp" id="rr-temp">--</span>
                                <span class="tyre-temp-unit">&deg;C</span>
                            </div>
                            <div class="tyre-rps-row">
                                <span class="tyre-rps" id="rr-rps">--</span>
                                <span class="tyre-rps-unit">rps</span>
                            </div>
                            <div class="tyre-radius-row">
                                <span class="tyre-radius" id="rr-radius">--</span>
                                <span class="tyre-radius-unit">m</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-title" style="margin-top: 4px;">SUSPENSION</div>
                <div class="suspension-grid">
                    <div class="susp-item">
                        <div class="susp-pos">FL</div>
                        <div class="susp-value" id="fl-susp">--</div>
                        <div class="susp-unit">mm</div>
                    </div>
                    <div class="susp-item">
                        <div class="susp-pos">FR</div>
                        <div class="susp-value" id="fr-susp">--</div>
                        <div class="susp-unit">mm</div>
                    </div>
                    <div class="susp-item">
                        <div class="susp-pos">RL</div>
                        <div class="susp-value" id="rl-susp">--</div>
                        <div class="susp-unit">mm</div>
                    </div>
                    <div class="susp-item">
                        <div class="susp-pos">RR</div>
                        <div class="susp-value" id="rr-susp">--</div>
                        <div class="susp-unit">mm</div>
                    </div>
                </div>
                <div class="card-title" style="margin-top: 4px;">ROAD SURFACE</div>
                <div class="position-row">
                    <span class="position-label">NRM</span>
                    <span class="position-value" id="road-plane-x">--</span>
                    <span class="position-value" id="road-plane-y">--</span>
                    <span class="position-value" id="road-plane-z">--</span>
                </div>
                <div class="position-row">
                    <span class="position-label">DST</span>
                    <span class="position-value" id="road-plane-dist">--</span>
                </div>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <div class="card race-info-card">
                <div class="race-position" id="race-position">--</div>
                <div class="race-position-label">START POS</div>
            </div>

            <div class="card lap-times-card">
                <div class="lap-row">
                    <span class="lap-label">LAP</span>
                    <span class="lap-value" id="current-lap">--</span>
                </div>
                <div class="lap-row">
                    <span class="lap-label">TIME</span>
                    <span class="lap-value lap-time-running" id="running-lap-time">--:--.---</span>
                </div>
                <div class="lap-row">
                    <span class="lap-label">CURRENT</span>
                    <span class="lap-value" id="current-lap-time">--:--.---</span>
                </div>
                <div class="lap-row">
                    <span class="lap-label">BEST</span>
                    <span class="lap-value" id="best-lap-time">--:--.---</span>
                </div>
            </div>

            <div class="card delta-card">
                <div class="delta-value" id="lap-delta">--</div>
                <div class="delta-label">SPEED VS BEST</div>
            </div>

            <div class="card lap-history-card">
                <div class="card-title">LAP HISTORY</div>
                <div id="lap-list" class="lap-history-list"></div>
            </div>

            <div class="card position-card">
                <div class="card-title">POSITION / DYNAMICS</div>
                <div class="position-row">
                    <span class="position-label">POS</span>
                    <span class="position-value" id="pos-x">--</span>
                    <span class="position-value" id="pos-y">--</span>
                    <span class="position-value" id="pos-z">--</span>
                </div>
                <div class="position-row">
                    <span class="position-label">VEL</span>
                    <span class="position-value" id="vel-x">--</span>
                    <span class="position-value" id="vel-y">--</span>
                    <span class="position-value" id="vel-z">--</span>
                </div>
                <div class="position-row">
                    <span class="position-label">ROT</span>
                    <span class="position-value" id="rot-pitch">--</span>
                    <span class="position-value" id="rot-yaw">--</span>
                    <span class="position-value" id="rot-roll">--</span>
                </div>
                <div class="position-row">
                    <span class="position-label">HDG</span>
                    <span class="position-value" id="orientation">--</span>
                    <span class="position-label" style="margin-left:8px">HGT</span>
                    <span class="position-value" id="body-height">--</span>
                </div>
            </div>

            <div class="card angular-velocity-card">
                <div class="card-title">ANGULAR VELOCITY 3D</div>

                <!-- 3D表示エリア -->
                <div class="rotation-3d-container">
                    <div class="cube-scene">
                        <div class="cube" id="rotation-cube">
                            <div class="cube-face cube-front"></div>
                            <div class="cube-face cube-back"></div>
                            <div class="cube-face cube-left"></div>
                            <div class="cube-face cube-right"></div>
                            <div class="cube-face cube-top"></div>
                            <div class="cube-face cube-bottom"></div>
                        </div>
                    </div>
                </div>

                <!-- 角度数値表示 -->
                <div class="position-row">
                    <span class="position-label">PIT</span>
                    <span class="position-value" id="rot-pitch-display">--</span>
                    <span class="position-label">YAW</span>
                    <span class="position-value" id="rot-yaw-display">--</span>
                    <span class="position-label">ROL</span>
                    <span class="position-value" id="rot-roll-display">--</span>
                </div>

                <!-- 回転矢印 -->
                <div class="rotation-indicators">
                    <div class="rotation-arrow" id="pitch-indicator">→</div>
                    <div class="rotation-arrow" id="yaw-indicator">→</div>
                    <div class="rotation-arrow" id="roll-indicator">→</div>
                </div>

                <!-- 角速度数値表示 -->
                <div class="position-row">
                    <span class="position-label">RATE</span>
                    <span class="position-value" id="pitch-rate">--</span>
                    <span class="position-value" id="yaw-rate">--</span>
                    <span class="position-value" id="roll-rate">--</span>
                </div>
            </div>

            <div class="stats-grid">
                <div class="card stat-card">
                    <div class="stat-value" id="car-id">--</div>
                    <div class="stat-label">CAR ID</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="pkg-id">--</div>
                    <div class="stat-label">PKG ID</div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="card stat-card">
                    <div class="stat-value" id="accel-g">--</div>
                    <div class="stat-label">ACCEL G</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="accel-decel">--</div>
                    <div class="stat-label">DECEL G</div>
                </div>
            </div>

            <div class="card body-accel-card">
                <div class="card-title">BODY ACCELERATION</div>
                <div class="stats-grid" style="margin:0">
                    <div class="body-accel-item">
                        <div class="body-accel-value" id="body-sway">--</div>
                        <div class="body-accel-label">SWAY (LAT)</div>
                    </div>
                    <div class="body-accel-item">
                        <div class="body-accel-value" id="body-heave">--</div>
                        <div class="body-accel-label">HEAVE (VERT)</div>
                    </div>
                    <div class="body-accel-item">
                        <div class="body-accel-value" id="body-surge">--</div>
                        <div class="body-accel-label">SURGE (LONG)</div>
                    </div>
                </div>
            </div>

            <div class="card accel-chart-card">
                <div class="chart-title">ACCELERATION (G)</div>
                <div class="accel-chart-container">
                    <canvas id="accel-chart"></canvas>
                </div>
            </div>

            <div class="card extended-data-card">
                <div class="card-title">EXTENDED</div>
                <div class="position-row">
                    <span class="position-label">TRQ</span>
                    <span class="position-value" id="torque-1">--</span>
                    <span class="position-value" id="torque-2">--</span>
                    <span class="position-value" id="torque-3">--</span>
                    <span class="position-value" id="torque-4">--</span>
                </div>
                <div class="position-row">
                    <span class="position-label">RGN</span>
                    <span class="position-value" id="energy-recovery">--</span>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="/uplot.min.js"></script>
    <script src="/ui_components.js"></script>
    <script src="/charts.js"></script>
    <script src="/car-3d.js"></script>
    <script src="/course-map.js"></script>
    <script src="/websocket.js"></script>
    <script src="/test-mode.js"></script>
    <script src="/app.js"></script>
</body>
</html>
