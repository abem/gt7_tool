<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WebSocket Debug</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #eee; }
        #status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .connected { background: #2ecc71; }
        .disconnected { background: #e74c3c; }
        .error { background: #f39c12; }
        pre { background: #000; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>WebSocket Debug</h1>
    <div id="status" class="disconnected">Connecting...</div>
    <h2>Connection Info:</h2>
    <pre id="info"></pre>
    <h2>Messages:</h2>
    <pre id="messages"></pre>
    <h2>Raw Data (last 5):</h2>
    <pre id="raw"></pre>

    <script>
        const statusEl = document.getElementById('status');
        const infoEl = document.getElementById('info');
        const msgEl = document.getElementById('messages');
        const rawEl = document.getElementById('raw');
        const rawDatas = [];

        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const host = window.location.host;
        const url = `${protocol}//${host}/ws`;

        infoEl.textContent = `URL: ${url}\nProtocol: ${window.location.protocol}\nHost: ${window.location.host}\nWebSocket Support: ${typeof WebSocket !== 'undefined'}`;

        try {
            const ws = new WebSocket(url);

            ws.onopen = () => {
                statusEl.textContent = 'Connected!';
                statusEl.className = 'connected';
                infoEl.textContent += '\n\nConnection established!';
            };

            ws.onerror = (e) => {
                console.error('WebSocket Error:', e);
                statusEl.textContent = 'Error (see console)';
                statusEl.className = 'error';
                infoEl.textContent += '\n\nError: ' + JSON.stringify(e);
            };

            ws.onclose = (e) => {
                statusEl.textContent = `Disconnected: code=${e.code} reason=${e.reason} wasClean=${e.wasClean}`;
                statusEl.className = 'disconnected';
                infoEl.textContent += `\n\nClosed: code=${e.code} reason=${e.reason}`;
            };

            ws.onmessage = (e) => {
                const data = e.data;
                msgEl.textContent = `Message #${msgEl.childElementCount + 1}: ${data.substring(0, 100)}...\n` + msgEl.textContent;

                rawDatas.push(data);
                if (rawDatas.length > 5) rawDatas.shift();
                rawEl.textContent = rawDatas.map((d, i) => `${i+1}. ${d}`).join('\n\n');
            };
        } catch (e) {
            statusEl.textContent = 'Exception: ' + e.message;
            statusEl.className = 'error';
            infoEl.textContent += '\n\nException: ' + e.message + '\n' + e.stack;
        }
    </script>
</body>
</html>
