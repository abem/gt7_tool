<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>Simple Test</title></head>
<body>
    <h1>Simple WebSocket Test</h1>
    <div id="status">Status: ...</div>
    <div id="speed">Speed: ...</div>
    <div id="count">Messages: 0</div>
    <script>
        const status = document.getElementById('status');
        const speed = document.getElementById('speed');
        const count = document.getElementById('count');
        let msgCount = 0;

        status.textContent = 'Status: Connecting...';

        const ws = new WebSocket('ws://127.0.0.1:8080/ws');

        ws.onopen = () => {
            status.textContent = 'Status: Connected!';
            status.style.color = 'green';
        };

        ws.onerror = (e) => {
            status.textContent = 'Status: Error - ' + e;
            status.style.color = 'red';
            console.error('WebSocket error:', e);
        };

        ws.onclose = (e) => {
            status.textContent = 'Status: Disconnected - ' + e.code;
            status.style.color = 'red';
        };

        ws.onmessage = (e) => {
            msgCount++;
            count.textContent = 'Messages: ' + msgCount;
            try {
                const data = JSON.parse(e.data);
                speed.textContent = 'Speed: ' + (data.speed_kmh || 0).toFixed(1) + ' km/h';
            } catch (err) {
                console.error('Parse error:', err);
            }
        };
    </script>
</body>
</html>
