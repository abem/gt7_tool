# 3D車両モデル 挙動改善計画書
## 「ブルブルしているだけでわからない」問題の解決（第2版）

---

## 1. 現状の問題点（第2版）

### 1.1 ユーザー報告（最新）
> - カーブ曲がるときタイヤが90度以上曲がる時があり不自然
> - 車体のノーズダイブしたときの前のめり感とか全くなくなった
> - 震動抑えつつ重心移動がわかり易く表現できないか

### 1.2 問題分析

| 問題 | 原因 | 対策 |
|------|------|------|
| **タイヤが90度以上曲がる** | TEST MODEのデモステアリング値が大きすぎる（±0.7 rad） | デモ値を現実的に調整 |
| **前のめり感がない** | `stiffness: 25` が低すぎて動きが小さい | バネ係数を上げる |
| **重心移動が分かりにくい** | 増幅が控えめすぎる（1.5/1.3） | 増幅を少し上げる |

### 1.3 現在のパラメータ（改善不足）

```javascript
amplification: { pitch: 1.5, roll: 1.3 }     // 小さすぎて動きが分からない
bounce: { stiffness: 25, damping: 4 }         // stiffness低すぎ
steering: { amplification: 1.0 }              // OK（実寸）
```

---

## 2. 改善方針（第2版）

### 2.1 コンセプト
**「振動なしで、重心移動が明確に分かる動き」**

- 微振動は**無効のまま**
- バネは**中程度の硬さ**（速すぎず遅すぎず）
- 増幅は**やや強め**（動きを明確に）
- ステアリングは**実寸＋補間のみ**

### 2.2 期待する動き

| シチュエーション | 期待動作 |
|-----------------|----------|
| **急ブレーキ** | 車体がグッと前傾 → 少し戻る（オーバーシュート） → 収束 |
| **急加速** | 車体がグッと後傾 → 少し戻る → 収束 |
| **コーナリング** | 車体が外側に傾く（ロール） → 戻る |
| **直進** | ほぼ静止（振動なし） |

---

## 3. パラメータ改定案（第2版）

### 3.1 新パラメータ

```javascript
var EXAGGERATION_CONFIG = {
    enabled: true,

    // 増幅設定（やや強めに）
    amplification: {
        pitch: 2.0,    // 1.5 → 2.0（前後の傾きを明確に）
        roll: 1.5      // 1.3 → 1.5（左右の傾きを明確に）
    },

    // バウンス設定（中程度の硬さ）
    bounce: {
        enabled: true,
        stiffness: 60,    // 25 → 60（適度な追従速度）
        damping: 8        // 4 → 8（適度な減衰）
    },

    // 慣性設定
    inertia: {
        enabled: true,
        lerpFactor: 0.12  // 0.08 → 0.12（少し速く追従）
    },

    // 微振動設定（無効のまま）
    vibration: {
        enabled: false,
        baseAmplitude: 0,
        rpmMultiplier: 0,
        frequency: 0
    },

    // ステアリング設定（実寸）
    steering: {
        amplification: 1.0,      // 実寸のまま
        lerpFactor: 0.15         // 0.2 → 0.15（少し滑らかに）
    }
};
```

### 3.2 パラメータの狙い

| パラメータ | 値 | 狙い |
|-----------|---|------|
| `pitch: 2.0` | 中程度 | ブレーキ/加速時の傾きを明確に |
| `roll: 1.5` | 中程度 | コーナリング時の傾きを明確に |
| `stiffness: 60` | 中程度 | 遅すぎず速すぎない追従 |
| `damping: 8` | 中程度 | オーバーシュートは出るが収束も早い |
| `stiffness/damping比` | 7.5 | バランス良い |

---

## 4. TEST MODEのステアリング調整

### 4.1 問題
現在の `getDemoSteering()` は `±0.7 rad`（約±40度）を返すことがあり、現実的でない

### 4.2 修正案

```javascript
function getDemoSteering() {
    // 現実的なステアリング角（最大±15度程度）
    var baseSteering = Math.sin(testTrajectoryIndex * 0.15) * 0.25;  // ±0.25 rad ≈ ±14°
    var quickTurn = Math.sin(testTrajectoryIndex * 0.4) * 0.05;      // ±0.05 rad ≈ ±3°
    return baseSteering + quickTurn;
}
```

---

## 5. 変更箇所まとめ

### 5.1 `car-3d.js` - EXAGGERATION_CONFIG

| パラメータ | 変更前 | 変更後 |
|-----------|--------|--------|
| `amplification.pitch` | 1.5 | **2.0** |
| `amplification.roll` | 1.3 | **1.5** |
| `bounce.stiffness` | 25 | **60** |
| `bounce.damping` | 4 | **8** |
| `inertia.lerpFactor` | 0.08 | **0.12** |
| `steering.lerpFactor` | 0.2 | **0.15** |

### 5.2 `test-mode.js` - getDemoSteering()

| パラメータ | 変更前 | 変更後 |
|-----------|--------|--------|
| `baseSteering` | ±0.5 rad | **±0.25 rad** |
| `quickTurn` | ±0.2 rad | **±0.05 rad** |
| 最大角 | ±0.7 rad (±40°) | **±0.3 rad (±17°)** |

---

## 6. 期待される効果

- ✅ タイヤが不自然に大きく曲がらない
- ✅ ブレーキ時の前のめり感が明確になる
- ✅ 加速時のリア沈み込みが明確になる
- ✅ コーナリング時のロールが分かりやすくなる
- ✅ 振動なしでクリーンな動き

---

**作成日:** 2024-XX-XX
**ステータス:** 計画段階（第2版）
**変更範囲:** `EXAGGERATION_CONFIG` + `test-mode.js`
