# 一般的な問題とトラブルシューティング

## 目次

1. [接続関連の問題](#接続関連の問題)
2. [データ表示関連の問題](#データ表示関連の問題)
3. [グラフ表示関連の問題](#グラフ表示関連の問題)
4. [パフォーマンス関連の問題](#パフォーマンス関連の問題)
5. [環境設定関連の問題](#環境設定関連の問題)

---

## 接続関連の問題

### 問題: "Client connected" が表示されない

**症状:**
- Dockerコンテナは起動しているが、PS5との接続が確立されない
- ログに "Client connected" が表示されない

**原因:**
- PS5のIPアドレスが間違っている
- PS5とPCが同じネットワークに接続されていない
- PS5のテレメトリ送信がOFFになっている
- ファイアウォールでUDPポートがブロックされている

**解決方法:**

1. **PS5のIPアドレスを確認**
   - PS5で「設定」→「ネットワーク」→「接続状態」を確認
   - メモしたIPアドレスと `config.json` の `ps5_ip` が一致しているか確認

2. **ネットワーク接続を確認**
   ```bash
   # PCからPS5にpingを送信
   ping <PS5のIPアドレス>
   ```
   - pingが通らない場合、ネットワーク設定を確認

3. **GT7のテレメトリ設定を確認**
   - GT7で「オプション」→「設定」→「コントローラー設定」→「通信設定」
   - 「テレメトリデータ送信」がONになっているか確認

4. **ファイアウォール設定を確認**
   - UDPポート 33740 がブロックされていないか確認
   - Windows: ファイアウォールの受信の規則を追加
   - Linux: `sudo ufw allow 33740/udp`
   - macOS: システム環境設定→セキュリティとプライバシー→ファイアウォール

---

## データ表示関連の問題

### 問題: ダッシュボードは表示されるがデータが更新されない

**症状:**
- ダッシュボードにはアクセスできる
- 速度やRPMなどが0のままで変化しない

**原因:**
- GT7が起動していない
- レース画面が表示されていない
- WebSocket接続が確立されていない

**解決方法:**

1. **GT7を起動してレース画面を表示**
   - タイムアタックまたはレースモードで走行を開始
   - メニュー画面ではテレメトリが送信されません

2. **WebSocket接続を確認**
   - ブラウザでF12を押して開発者ツールを開く
   - Consoleタブで `ws connected` と表示されているか確認

3. **サーバーログを確認**
   ```bash
   docker compose logs
   ```
   - `[RX] Started receiving` と表示されているか確認

---

## グラフ表示関連の問題

### 問題: グラフが表示されない

**症状:**
- 速度やRPMなどの数値は表示される
- グラフ（チャート）が表示されない

**原因:**
- uPlotライブラリが読み込まれていない
- ブラウザキャッシュの問題
- JavaScriptエラーが発生している

**解決方法:**

1. **ブラウザを強制リロード**
   - Windows: `Ctrl + F5`
   - Mac: `Cmd + Shift + R`

2. **uPlotライブラリが読み込まれているか確認**
   - F12で開発者ツールを開く
   - Consoleタブで以下を入力:
     ```javascript
     typeof uPlot
     ```
   - `"function"` と表示されればOK
   - `"undefined"` と表示される場合、ライブラリが読み込まれていない

3. **JavaScriptエラーを確認**
   - Consoleタブに赤いエラーメッセージがないか確認
   - エラーがある場合、以下を確認:
     - `uplot.min.js` ファイルが存在するか
     - ファイルサイズが約51KBであるか

4. **ネットワークタブを確認**
   - F12 → Networkタブ
   - ページをリロード
   - `uplot.min.js` と `uplot.min.css` がステータス200で読み込まれているか確認

---

## パフォーマンス関連の問題

### 問題: 表示が遅い/カクつく

**症状:**
- グラフの更新が遅れる
- ブラウザが重くなる

**原因:**
- 複数のブラウザタブでダッシュボードを開いている
- PCのスペックが不足している
- ネットワーク遅延

**解決方法:**

1. **不要なブラウザタブを閉じる**
   - 複数タブでダッシュボードを開いていると、それぞれでWebSocket接続が作成されます

2. **PCのスペックを確認**
   - 推奨スペック: デュアルコア以上、4GB以上のメモリ

3. **データ更新頻度を調整**
   - バックエンド側 (`main.py`) のデータ送信間隔を変更して、更新頻度を下げる

---

## 環境設定関連の問題

### 問題: Dockerが起動しない

**症状:**
- `docker compose up` でエラーが発生する

**原因:**
- Dockerがインストールされていない
- Dockerデーモンが起動していない
- ポート8080が使用中

**解決方法:**

1. **Dockerがインストールされているか確認**
   ```bash
   docker --version
   docker compose version
   ```

2. **Dockerデーモンの状態を確認**
   ```bash
   docker ps
   ```
   - エラーが出る場合、Dockerアプリを起動

3. **ポート8080が使用中か確認**
   ```bash
   # Linux/Mac
   lsof -i :8080

   # Windows
   netstat -ano | findstr :8080
   ```
   - 使用中の場合、他のアプリを停止するか `config.json` で `http_port` を変更

---

## コース推定関連の問題

### 問題: コース名が「Unknown Circuit」と表示される

**症状:**
- コースマップは表示される
- コース名が正しく推定されない

**原因:**
- コースデータベースにそのコースの情報が登録されていない

**解決方法:**

1. **新しいコースを学習させる**
   ```bash
   docker compose exec app python test_course_detection.py --data-dir gt7data
   ```

2. **手動でコースを追加**
   - `course_database.json` を編集
   - 新しいコースの座標範囲を追加

---

## テストモード関連の問題

### 問題: TEST MODEが動作しない

**症状:**
- 「TEST MODE」ボタンをクリックしても反応しない
- デモデータが表示されない

**解決方法:**

1. **WebSocket接続を確認**
   - TEST MODEもWebSocket接続が必要
   - サーバーが起動しているか確認

2. **ブラウザコンソールでエラーを確認**
   - F12 → Consoleタブ
   - JavaScriptエラーがないか確認

---

## それでも問題が解決しない場合

以下の情報を収集して、問題報告を作成してください：

1. **環境情報**
   - OS:
   - Dockerバージョン:
   - ブラウザとバージョン:
   - PS5/PS4:

2. **サーバーログ**
   ```bash
   docker compose logs > logs.txt
   ```

3. **ブラウザコンソールログ**
   - F12 → Consoleタブのスクリーンショットまたはテキスト

4. **ネットワークタブ情報**
   - F12 → Networkタブのスクリーンショット

---

**最終更新**: 2026-02-13
